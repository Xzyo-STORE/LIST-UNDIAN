<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XZYO STORE - LIVE DATABASE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --blue: #0072ff; --bg: #0b1220; --card: #111a33; --green: #00ff88; }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: white; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .wrapper { max-width: 600px; width: 100%; }
        .card { background: var(--card); border-radius: 15px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #1e293b; margin-top: 10px; background: #0b1220; color: white; outline: none; }
        .btn { width: 100%; padding: 15px; border-radius: 12px; border: none; margin-top: 15px; background: var(--blue); color: white; font-weight: bold; cursor: pointer; }
        .item { background: rgba(255,255,255,0.03); padding: 15px; margin-top: 10px; border-radius: 12px; display: flex; align-items: center; border-left: 4px solid var(--blue); }
        .rank { width: 35px; height: 35px; background: var(--blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px; }
        .price { margin-left: auto; color: var(--green); font-weight: 800; text-align: right; }
    </style>
</head>
<body>

<div class="wrapper">
    <h2 style="text-align:center">ðŸ‘‘ VIP SULTAN XZYO ðŸ‘‘</h2>

    <div id="adminBox" class="card" style="display:none;">
        <h4 style="margin:0">Panel Input Admin</h4>
        <input type="text" id="nama" placeholder="Nama Pelanggan">
        <input type="number" id="wa" placeholder="Nomor WhatsApp">
        <input type="number" id="nominal" placeholder="Nominal Joki (Rp)">
        <button class="btn" onclick="simpanData()">UPDATE LIST SEKARANG</button>
    </div>

    <div class="card">
        <div id="listLeaderboard">Menghubungkan ke database...</div>
    </div>
</div>

<script>
    // Konfigurasi Firebase Milik Rahmat
    const firebaseConfig = {
        apiKey: "AIzaSyC6aUjN60bSDE0BLVs3V-yNRYfSsPv0ZV8",
        authDomain: "xzyostore-66448.firebaseapp.com",
        databaseURL: "https://xzyostore-66448-default-rtdb.firebaseio.com",
        projectId: "xzyostore-66448",
        storageBucket: "xzyostore-66448.firebasestorage.app",
        messagingSenderId: "547146618223",
        appId: "1:547146618223:web:978b8956cc0293cfb7449a"
    };

    // Inisialisasi
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.database();

    // Munculkan panel admin jika ada ?admin=true
    if(new URLSearchParams(window.location.search).get('admin') === 'true') {
        document.getElementById('adminBox').style.display = 'block';
    }

    // Fungsi Simpan
    function simpanData() {
        const n = document.getElementById('nama').value.trim();
        const w = document.getElementById('wa').value.trim();
        const p = parseInt(document.getElementById('nominal').value);

        if(!n || !p) return alert("Isi nama & nominal lek!");

        const userRef = db.ref('leaderboard/' + n);
        userRef.once('value').then((snapshot) => {
            const current = snapshot.val() || { total: 0, count: 0 };
            userRef.update({
                total: current.total + p,
                count: current.count + 1,
                whatsapp: w || current.whatsapp || "-"
            }).then(() => {
                alert("Data Berhasil Masuk!");
                document.getElementById('nominal').value = "";
            });
        });
    }

    // Tampilkan Data secara Realtime
    db.ref('leaderboard').on('value', (snapshot) => {
        const container = document.getElementById('listLeaderboard');
        const data = snapshot.val();
        
        if(!data) {
            container.innerHTML = "<center>Belum ada data Sultan.</center>";
            return;
        }

        container.innerHTML = "";
        const sortedKeys = Object.keys(data).sort((a, b) => data[b].total - data[a].total);

        sortedKeys.forEach((key, index) => {
            const user = data[key];
            const isSultan = user.total >= 100000 ? ' <i class="fa-solid fa-circle-check" style="color:#00ff88"></i>' : '';
            const isKing = user.count >= 5 ? ' <i class="fa-solid fa-crown" style="color:#ffd700"></i>' : '';
            
            container.innerHTML += `
                <div class="item">
                    <div class="rank">${index + 1}</div>
                    <div>
                        <b>${key}</b>${isSultan}${isKing}
                        <br><small style="color:#7cc7ff">WA: ${user.whatsapp}</small>
                    </div>
                    <div class="price">
                        Rp ${user.total.toLocaleString()}
                        <br><small style="color:#777">${user.count}x Joki</small>
                    </div>
                </div>
            `;
        });
    });
</script>
</body>
</html>
